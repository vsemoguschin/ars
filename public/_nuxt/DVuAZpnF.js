import{_ as et}from"./DbRmwbl4.js";import{_ as st,a as ot}from"./xG5u76J_.js";import{_ as lt}from"./CCxNnwLh.js";import{_ as nt}from"./C0NPybpO.js";import{_ as at,a as rt,b as dt,c as it,d as ut,e as ct,f as mt,g as pt,h as ft,i as _t,j as vt,k as yt,l as gt,m as $t}from"./Bk-8HdKD.js";import{_ as bt,a as xt}from"./LXi238kQ.js";import{d as Ut,a as wt,u as Ct,C as Vt,r as c,o as kt,t as f,v as $,x as a,z as e,A as s,B as r,D as n,y as w,E as Dt,F as Tt,G as S,H as E,I as At,J as Bt}from"./CE95Wurm.js";import{u as Ot}from"./C5GjP6W8.js";import"./BGzDuTtR.js";import"./DkIjAwkr.js";const Mt={class:"p-6"},Ft={class:"flex gap-3"},Ht={key:0,class:"text-center"},It={key:1,class:"text-red-500 text-center"},Nt={key:2,class:"flex flex-col gap-3"},jt={class:"mt-4 flex justify-between"},Rt={key:0,class:"text-green-500 mt-4"},St={class:"p-6 pb-2"},Et={class:"flex gap-3"},Lt={class:"flex flex-col gap-3"},zt={class:"flex justify-between w-full"},Gt={class:"p-6"},Jt={class:"flex gap-3"},oe=Ut({__name:"[id]",setup(qt){const{$useApi:m}=wt(),D=Ct(),L=Vt();Ot({title:"Контрагент"});const _=L.params.id,d=c({id:0,name:"",phone:"",inn:"",contractor_type:""}),T=c([]),x=c(!0),v=c(null),U=c(""),p=c([]),A=c([]),i=c(!1),y=c({address:"",address_type:"",contractor:_}),z=async()=>{try{const{data:o}=await m.get(`/contractors/${_}/`);d.value={id:o.id||0,name:o.name||"",phone:o.phone||"",inn:o.inn||"",contractor_type:o.contractor_type||""};const{data:t}=await m.get("/contractor-types/");T.value=t,await q(),await B()}catch(o){v.value=o.message}finally{x.value=!1}},G=async()=>{try{const o=await m.patch(`/contractors/${_}/`,d.value);U.value="Контрагент успешно обновлён!",setTimeout(()=>U.value="",3e3)}catch(o){v.value=o.message}},J=async()=>{try{const o=await m.delete(`/contractors/${_}`);console.log("Контрагент удалён!"),D.push("/contractors")}catch(o){console.error("Ошибка удаления контрагента:",o)}},q=async()=>{try{const{data:o}=await m.get(`/contractor-addresses/?contractor=${_}`);p.value=o,console.log(p.value)}catch(o){v.value=o.message}finally{x.value=!1}},K=async()=>{try{const{data:o}=await m.post("/contractor-addresses/",y.value);p.value.push(o),i.value=!1,y.value={address:"",address_type:"",contractor:_}}catch(o){console.error("Ошибка создания контрагента:",o)}},P=async o=>{try{const t=await m.delete(`/contractor-addresses/${o}`);p.value=p.value.filter(u=>u.id!==o)}catch(t){console.error("Ошибка удаления адреса:",t)}},B=async()=>{try{const{data:o}=await m.get("/orders/?contractor=${contractorId}");A.value=o}catch(o){v.value=o.message}finally{x.value=!1}};return kt(z),(o,t)=>{const u=et,g=st,b=ot,Q=lt,C=nt,O=at,M=rt,F=dt,H=it,I=ut,N=ct,j=mt,W=pt,V=ft,R=_t,X=vt,k=yt,Y=gt,Z=$t,h=bt,tt=xt;return f(),$(E,null,[a("div",Mt,[a("div",Ft,[e(u,{onClick:t[0]||(t[0]=l=>n(D).push("/contractors")),class:"h-8 w-8"},{default:s(()=>t[12]||(t[12]=[r(" < ")])),_:1}),t[13]||(t[13]=a("h1",{class:"text-2xl font-bold mb-4"},"Контрагент",-1))]),n(x)?(f(),$("div",Ht,t[14]||(t[14]=[a("p",null,"Загрузка...",-1)]))):n(v)?(f(),$("div",It,[a("p",null,"Ошибка загрузки: "+w(n(v)),1)])):(f(),$("div",Nt,[a("div",null,[e(g,{for:"name"},{default:s(()=>t[15]||(t[15]=[r("Название")])),_:1}),e(b,{class:"mt-2",id:"name",modelValue:n(d).name,"onUpdate:modelValue":t[1]||(t[1]=l=>n(d).name=l),placeholder:"Введите название контрагента"},null,8,["modelValue"])]),a("div",null,[e(g,{for:"phone"},{default:s(()=>t[16]||(t[16]=[r("Телефон")])),_:1}),e(b,{class:"mt-2",id:"phone",modelValue:n(d).phone,"onUpdate:modelValue":t[2]||(t[2]=l=>n(d).phone=l),placeholder:"Введите номер телефона"},null,8,["modelValue"])]),a("div",null,[e(g,{for:"inn"},{default:s(()=>t[17]||(t[17]=[r("ИНН")])),_:1}),e(b,{class:"mt-2",id:"inn",modelValue:n(d).inn,"onUpdate:modelValue":t[3]||(t[3]=l=>n(d).inn=l),placeholder:"Введите ИНН"},null,8,["modelValue"])]),a("div",null,[e(g,{for:"contractor_type"},{default:s(()=>t[18]||(t[18]=[r("Тип контрагента")])),_:1}),e(Q,{class:"mt-2",items:n(T).map(l=>l.name),label:n(d).contractor_type,onSelectedItem:t[4]||(t[4]=l=>n(d).contractor_type=l)},null,8,["items","label"])]),a("div",jt,[e(u,{onClick:Dt(J,["stop"])},{default:s(()=>t[19]||(t[19]=[r("Удалить")])),_:1}),e(u,{onClick:G},{default:s(()=>t[20]||(t[20]=[r("Сохранить")])),_:1})]),n(U)?(f(),$("p",Rt,w(n(U)),1)):Tt("",!0)]))]),e(C,{label:""}),a("div",St,[a("div",Et,[e(j,{open:n(i),"onUpdate:open":t[9]||(t[9]=l=>S(i)?i.value=l:null)},{default:s(()=>[e(O,{"as-child":""},{default:s(()=>[e(u,{onClick:t[5]||(t[5]=l=>i.value=!0),class:"h-8 w-8"},{default:s(()=>t[21]||(t[21]=[r(" + ")])),_:1})]),_:1}),e(N,null,{default:s(()=>[e(H,null,{default:s(()=>[e(M,null,{default:s(()=>t[22]||(t[22]=[r("Добавить адрес")])),_:1}),e(F)]),_:1}),a("div",Lt,[a("div",null,[e(g,{for:"address"},{default:s(()=>t[23]||(t[23]=[r("Адрес")])),_:1}),e(b,{class:"mt-2",id:"address",modelValue:n(y).address,"onUpdate:modelValue":t[6]||(t[6]=l=>n(y).address=l),placeholder:"Введите адрес контрагента"},null,8,["modelValue"])]),a("div",null,[e(g,{for:"address_type"},{default:s(()=>t[24]||(t[24]=[r("Тип")])),_:1}),e(b,{class:"mt-2",id:"address_type",modelValue:n(y).address_type,"onUpdate:modelValue":t[7]||(t[7]=l=>n(y).address_type=l),placeholder:"Введите тип"},null,8,["modelValue"])])]),e(I,null,{default:s(()=>[a("div",zt,[e(u,{class:"mb-2",onClick:t[8]||(t[8]=l=>i.value=!1)},{default:s(()=>t[25]||(t[25]=[r("Отмена")])),_:1}),e(u,{onClick:K},{default:s(()=>t[26]||(t[26]=[r("Добавить")])),_:1})])]),_:1})]),_:1})]),_:1},8,["open"]),t[27]||(t[27]=a("h1",{class:"text-2xl font-bold mb-4"},"Адреса контрагента",-1))]),e(Z,null,{default:s(()=>[e(W),e(X,{class:"bg-slate-100"},{default:s(()=>[e(R,null,{default:s(()=>[e(V,null,{default:s(()=>t[28]||(t[28]=[r("Тип")])),_:1}),e(V,null,{default:s(()=>t[29]||(t[29]=[r("Адрес")])),_:1}),e(V,null,{default:s(()=>t[30]||(t[30]=[r("Действия")])),_:1})]),_:1})]),_:1}),e(Y,null,{default:s(()=>[(f(!0),$(E,null,At(n(p),l=>(f(),Bt(R,{key:l.id},{default:s(()=>[e(k,null,{default:s(()=>[r(w(l.address_type),1)]),_:2},1024),e(k,null,{default:s(()=>[r(w(l.address),1)]),_:2},1024),e(k,null,{default:s(()=>[e(u,{class:"h-5 w-5 p-0",onClick:Kt=>P(l.id)},{default:s(()=>t[31]||(t[31]=[r("-")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),e(C,{label:""}),a("div",Gt,[a("div",Jt,[a("div",null,[e(j,{open:n(i),"onUpdate:open":t[11]||(t[11]=l=>S(i)?i.value=l:null)},{default:s(()=>[e(O,{"as-child":""},{default:s(()=>[e(u,{class:"h-8 w-8"},{default:s(()=>t[32]||(t[32]=[r(" + ")])),_:1})]),_:1}),e(N,null,{default:s(()=>[e(H,null,{default:s(()=>[e(M,null,{default:s(()=>t[33]||(t[33]=[r("Создать заказ")])),_:1}),e(F)]),_:1}),e(h,{client:n(d),client_addresses:n(p),onOrderCreated:t[10]||(t[10]=()=>{B(),i.value=!1})},null,8,["client","client_addresses"]),e(I)]),_:1})]),_:1},8,["open"])]),t[34]||(t[34]=a("h1",{class:"text-2xl font-bold mb-4"},"Заказы",-1))]),e(tt,{orders:n(A)},null,8,["orders"])]),e(C,{label:""})],64)}}});export{oe as default};
