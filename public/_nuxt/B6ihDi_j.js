import{_ as D}from"./DbRmwbl4.js";import{_ as E,a as F}from"./xG5u76J_.js";import{_ as j}from"./BGzDuTtR.js";import{_ as z}from"./CCxNnwLh.js";import{_ as H,a as L,b as q,c as G,d as J}from"./DkIjAwkr.js";import{_ as K}from"./C0NPybpO.js";import{d as O,a as Q,u as W,C as X,r as i,o as Y,t as _,v as c,x as r,z as t,A as s,B as m,D as o,y as C,E as Z,F as h}from"./CE95Wurm.js";import{u as ee}from"./C5GjP6W8.js";const te={class:"p-6"},oe={class:"flex gap-3"},le={key:0,class:"text-center"},ne={key:1,class:"text-red-500 text-center"},ae={key:2,class:"flex flex-col gap-3"},se={class:"flex flex-col gap-3"},re={class:"mt-4 flex justify-between"},me={key:0,class:"text-green-500 mt-4"},ge=O({__name:"[id]",setup(pe){const{$useApi:u}=Q(),V=W(),k=X();ee({title:"Предоплата"});const g=k.params.id,n=i({prepayment_type:"",unit:"m3",total_volume:0,remaining_volume:0,price_per_unit:0,total_price:0,contractor:0}),b=i([]),x=i([]),$=i(!0),f=i(null),y=i(""),w=async()=>{try{const{data:a}=await u.get(`/prepayments/${g}`);n.value={prepayment_type:a.prepayment_type||"",unit:a.unit||"m3",total_volume:a.total_volume||0,remaining_volume:a.remaining_volume||0,price_per_unit:a.price_per_unit||0,total_price:a.total_price||0,contractor:a.contractor||0};const{data:e}=await u.get("/prepayment-types/");b.value=e;const{data:d}=await u.get("/contractors/");x.value=d}catch(a){f.value=a.message}finally{$.value=!1}},S=async()=>{try{console.log(n.value.contractor);const{data:a}=await u.patch(`/prepayments/${g}/`,n.value);n.value=a,y.value="Авансовый платеж успешно обновлён!",setTimeout(()=>y.value="",3e3)}catch(a){f.value=a.message}},M=async()=>{try{await u.delete(`/prepayments/${g}/`),console.log("Авансовый платеж удалён!"),V.push("/prepayments")}catch(a){console.error("Ошибка удаления авансового платежа:",a)}};return Y(w),(a,e)=>{const d=D,p=E,B=j,I=z,N=H,P=L,U=q,R=G,T=J,v=F,A=K;return _(),c("div",null,[r("div",te,[r("div",oe,[t(d,{onClick:e[0]||(e[0]=l=>o(V).push("/prepayments")),class:"h-8 w-8"},{default:s(()=>e[8]||(e[8]=[m(" < ")])),_:1}),e[9]||(e[9]=r("h1",{class:"text-2xl font-bold mb-4"},"Предоплата",-1))]),o($)?(_(),c("div",le,e[10]||(e[10]=[r("p",null,"Загрузка...",-1)]))):o(f)?(_(),c("div",ne,[r("p",null,"Ошибка загрузки: "+C(o(f)),1)])):(_(),c("div",ae,[r("div",se,[t(p,{for:"contractor"},{default:s(()=>e[11]||(e[11]=[m("Контрагент")])),_:1}),t(B,{items:o(x).map(l=>({value:l.id,label:l.name})),label:o(x).find(l=>l.id===o(n).contractor).name,onSelectedItem:e[1]||(e[1]=l=>o(n).contractor=l)},null,8,["items","label"])]),r("div",null,[t(p,{for:"prepayment_type"},{default:s(()=>e[12]||(e[12]=[m("Тип авансового платежа")])),_:1}),t(I,{class:"mt-2",items:o(b).map(l=>l.name),label:o(n).prepayment_type,onSelectedItem:e[2]||(e[2]=l=>o(n).prepayment_type=l)},null,8,["items","label"])]),r("div",null,[t(p,{for:"unit"},{default:s(()=>e[13]||(e[13]=[m("Единица измерения")])),_:1}),t(T,{modelValue:o(n).unit,"onUpdate:modelValue":e[3]||(e[3]=l=>o(n).unit=l)},{default:s(()=>[t(P,null,{default:s(()=>[t(N,{placeholder:"Выберите единицу"})]),_:1}),t(R,null,{default:s(()=>[t(U,{value:"m3"},{default:s(()=>e[14]||(e[14]=[m("м³")])),_:1}),t(U,{value:"ton"},{default:s(()=>e[15]||(e[15]=[m("Тонны")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),r("div",null,[t(p,{for:"total_volume"},{default:s(()=>e[16]||(e[16]=[m("Общий объем")])),_:1}),t(v,{class:"mt-2",id:"total_volume",type:"number",modelValue:o(n).total_volume,"onUpdate:modelValue":e[4]||(e[4]=l=>o(n).total_volume=l),placeholder:"Введите общий объем"},null,8,["modelValue"])]),r("div",null,[t(p,{for:"remaining_volume"},{default:s(()=>e[17]||(e[17]=[m("Оставшийся объем")])),_:1}),t(v,{class:"mt-2",id:"remaining_volume",type:"number",modelValue:o(n).remaining_volume,"onUpdate:modelValue":e[5]||(e[5]=l=>o(n).remaining_volume=l),placeholder:"Введите оставшийся объем"},null,8,["modelValue"])]),r("div",null,[t(p,{for:"price_per_unit"},{default:s(()=>e[18]||(e[18]=[m("Цена за единицу")])),_:1}),t(v,{class:"mt-2",id:"price_per_unit",type:"number",modelValue:o(n).price_per_unit,"onUpdate:modelValue":e[6]||(e[6]=l=>o(n).price_per_unit=l),placeholder:"Введите цену за единицу"},null,8,["modelValue"])]),r("div",null,[t(p,{for:"total_price"},{default:s(()=>e[19]||(e[19]=[m("Общая стоимость")])),_:1}),t(v,{class:"mt-2",id:"total_price",type:"number",modelValue:o(n).total_price,"onUpdate:modelValue":e[7]||(e[7]=l=>o(n).total_price=l),placeholder:"Введите общую стоимость"},null,8,["modelValue"])]),r("div",re,[t(d,{onClick:Z(M,["stop"])},{default:s(()=>e[20]||(e[20]=[m("Удалить")])),_:1}),t(d,{onClick:S},{default:s(()=>e[21]||(e[21]=[m("Сохранить")])),_:1})]),o(y)?(_(),c("p",me,C(o(y)),1)):h("",!0)]))]),t(A)])}}});export{ge as default};
