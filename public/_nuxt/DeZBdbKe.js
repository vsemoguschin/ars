import{_ as W}from"./DbRmwbl4.js";import{_ as X,a as Y,b as Z,c as h,d as tt,e as et,f as lt,g as nt,h as ot,i as at,j as st,k as it,l as ut,m as mt}from"./Bk-8HdKD.js";import{_ as rt,a as _t}from"./xG5u76J_.js";import{_ as dt}from"./BGzDuTtR.js";import{_ as pt}from"./CCxNnwLh.js";import{_ as ft,a as ct,b as vt,c as yt,d as gt}from"./DkIjAwkr.js";import{d as bt,a as $t,u as Ut,r,o as xt,t as c,v,x as i,z as e,A as l,B as o,D as a,G as Vt,y as _,H as kt,I as wt,J as Ct}from"./CE95Wurm.js";import{u as Dt}from"./C5GjP6W8.js";const Tt={class:"p-6"},St={class:"flex gap-2 mb-4"},Bt={class:"flex flex-col gap-3"},Ht={class:"flex flex-col gap-2"},It={class:"flex justify-between w-full"},Pt={key:0,class:"text-center"},Mt={key:1,class:"text-red-500 text-center"},Nt={key:2},qt=bt({__name:"index",setup(jt){const{$useApi:y}=$t(),x=Ut();Dt({title:"Предоплаты"});const $=r([]),V=r([]),k=r([]),w=r(!0),U=r(null),d=r(!1),s=r({prepayment_type:"",unit:"m3",total_volume:0,remaining_volume:0,price_per_unit:0,total_price:0,contractor:0,contractor_name:""}),B=async()=>{try{const{data:u}=await y.get("/prepayments/");$.value=u,await C(),await D()}catch(u){U.value=u.message}finally{w.value=!1}},C=async()=>{const{data:u}=await y.get("/prepayment-types/");V.value=u},D=async()=>{const{data:u}=await y.get("/contractors/");k.value=u},H=async()=>{try{const{data:u}=await y.post("/prepayments/",s.value);$.value.push(u),d.value=!1,s.value={prepayment_type:"",unit:"m3",total_volume:0,remaining_volume:0,price_per_unit:0,total_price:0,contractor:0,contractor_name:""}}catch(u){console.error("Ошибка создания авансового платежа:",u)}};return xt(B),(u,t)=>{const g=W,I=X,P=Y,M=Z,N=h,m=rt,j=dt,A=pt,R=ft,F=ct,T=vt,L=yt,z=gt,b=_t,E=tt,G=et,J=lt,O=nt,p=ot,S=at,q=st,f=it,K=ut,Q=mt;return c(),v("div",Tt,[t[33]||(t[33]=i("h1",{class:"text-2xl font-bold mb-4"},"Предоплаты",-1)),i("div",St,[e(g,{onClick:t[0]||(t[0]=n=>a(x).push("/")),class:"h-8 w-8"},{default:l(()=>t[11]||(t[11]=[o(" < ")])),_:1}),e(J,{open:a(d),"onUpdate:open":t[10]||(t[10]=n=>Vt(d)?d.value=n:null)},{default:l(()=>[e(I,{"as-child":""},{default:l(()=>[e(g,{onClick:t[1]||(t[1]=async()=>{await C(),await D(),d.value=!0}),class:"h-8 w-8"},{default:l(()=>t[12]||(t[12]=[o(" + ")])),_:1})]),_:1}),e(G,null,{default:l(()=>[e(N,null,{default:l(()=>[e(P,null,{default:l(()=>t[13]||(t[13]=[o("Создать предоплату")])),_:1}),e(M)]),_:1}),i("div",Bt,[i("div",Ht,[e(m,{for:"contractor"},{default:l(()=>t[14]||(t[14]=[o("Контрагент")])),_:1}),e(j,{items:a(k).map(n=>({value:n.id,label:n.name})),label:"Выбрать",onSelectedItem:t[2]||(t[2]=n=>a(s).contractor=n)},null,8,["items"])]),i("div",null,[e(m,{for:"prepayment_type"},{default:l(()=>t[15]||(t[15]=[o("Тип предоплаты")])),_:1}),e(A,{class:"mt-2",items:a(V).map(n=>n.name),label:"Тип аванса",onSelectedItem:t[3]||(t[3]=n=>a(s).prepayment_type=n)},null,8,["items"])]),i("div",null,[e(m,{for:"unit"},{default:l(()=>t[16]||(t[16]=[o("Единица измерения")])),_:1}),e(z,{modelValue:a(s).unit,"onUpdate:modelValue":t[4]||(t[4]=n=>a(s).unit=n)},{default:l(()=>[e(F,null,{default:l(()=>[e(R,{placeholder:"Выберите единицу"})]),_:1}),e(L,null,{default:l(()=>[e(T,{value:"m3"},{default:l(()=>t[17]||(t[17]=[o("м³")])),_:1}),e(T,{value:"ton"},{default:l(()=>t[18]||(t[18]=[o("Тонны")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",null,[e(m,{for:"total_volume"},{default:l(()=>t[19]||(t[19]=[o("Объем")])),_:1}),e(b,{class:"mt-2",id:"total_volume",type:"number",modelValue:a(s).total_volume,"onUpdate:modelValue":t[5]||(t[5]=n=>a(s).total_volume=n),placeholder:"Введите объем"},null,8,["modelValue"])]),i("div",null,[e(m,{for:"remaining_volume"},{default:l(()=>t[20]||(t[20]=[o("Оставшийся объем")])),_:1}),e(b,{class:"mt-2",id:"remaining_volume",type:"number",modelValue:a(s).remaining_volume,"onUpdate:modelValue":t[6]||(t[6]=n=>a(s).remaining_volume=n),placeholder:"Введите оставшийся объем"},null,8,["modelValue"])]),i("div",null,[e(m,{for:"price_per_unit"},{default:l(()=>t[21]||(t[21]=[o("Цена за единицу")])),_:1}),e(b,{class:"mt-2",id:"price_per_unit",type:"number",modelValue:a(s).price_per_unit,"onUpdate:modelValue":t[7]||(t[7]=n=>a(s).price_per_unit=n),placeholder:"Введите цену за единицу"},null,8,["modelValue"])]),i("div",null,[e(m,{for:"total_price"},{default:l(()=>t[22]||(t[22]=[o("Стоимость")])),_:1}),e(b,{class:"mt-2",id:"total_price",type:"number",modelValue:a(s).total_price,"onUpdate:modelValue":t[8]||(t[8]=n=>a(s).total_price=n),placeholder:"Введите общую стоимость"},null,8,["modelValue"])])]),e(E,null,{default:l(()=>[i("div",It,[e(g,{class:"mb-2",onClick:t[9]||(t[9]=n=>d.value=!1)},{default:l(()=>t[23]||(t[23]=[o("Отмена")])),_:1}),e(g,{onClick:H},{default:l(()=>t[24]||(t[24]=[o("Создать")])),_:1})])]),_:1})]),_:1})]),_:1},8,["open"])]),a(w)?(c(),v("div",Pt,t[25]||(t[25]=[i("p",null,"Загрузка...",-1)]))):a(U)?(c(),v("div",Mt,[i("p",null,"Ошибка загрузки: "+_(a(U)),1)])):(c(),v("div",Nt,[e(Q,null,{default:l(()=>[e(O,null,{default:l(()=>t[26]||(t[26]=[o("Список предоплат.")])),_:1}),e(q,{class:"bg-slate-100"},{default:l(()=>[e(S,null,{default:l(()=>[e(p,null,{default:l(()=>t[27]||(t[27]=[o("Тип")])),_:1}),e(p,null,{default:l(()=>t[28]||(t[28]=[o("Контрагент")])),_:1}),e(p,null,{default:l(()=>t[29]||(t[29]=[o("Объем общий")])),_:1}),e(p,null,{default:l(()=>t[30]||(t[30]=[o("Объем")])),_:1}),e(p,null,{default:l(()=>t[31]||(t[31]=[o("Цена за ед.")])),_:1}),e(p,null,{default:l(()=>t[32]||(t[32]=[o("Стоимость")])),_:1})]),_:1})]),_:1}),e(K,null,{default:l(()=>[(c(!0),v(kt,null,wt(a($),n=>(c(),Ct(S,{key:n.id,onClick:At=>a(x).push(`/prepayments/${n.id}`),class:"cursor-pointer hover:bg-gray-100"},{default:l(()=>[e(f,null,{default:l(()=>[o(_(n.prepayment_type),1)]),_:2},1024),e(f,null,{default:l(()=>[o(_(n.contractor_name),1)]),_:2},1024),e(f,null,{default:l(()=>[o(_(n.total_volume),1)]),_:2},1024),e(f,null,{default:l(()=>[o(_(n.remaining_volume),1)]),_:2},1024),e(f,null,{default:l(()=>[o(_(n.price_per_unit),1)]),_:2},1024),e(f,null,{default:l(()=>[o(_(n.total_price),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]))])}}});export{qt as default};
