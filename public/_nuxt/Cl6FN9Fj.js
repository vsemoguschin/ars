import{_ as L}from"./DbRmwbl4.js";import{_ as q,a as G}from"./xG5u76J_.js";import{_ as J}from"./CCxNnwLh.js";import{_ as K}from"./BGzDuTtR.js";import{_ as P,a as Q,b as W,c as X,d as Y}from"./DkIjAwkr.js";import{_ as Z}from"./C0NPybpO.js";import{d as h,a as ee,u as te,C as le,r as u,o as oe,t as c,v as f,x as d,z as o,A as n,B as r,D as l,y as T,E as se,F as ae}from"./CE95Wurm.js";import{u as ne}from"./C5GjP6W8.js";const de={class:"p-6"},re={class:"flex gap-3"},ie={key:0,class:"text-center"},me={key:1,class:"text-red-500 text-center"},ue={key:2,class:"flex flex-col gap-3"},pe={class:"flex flex-col gap-2"},_e={class:"flex flex-col gap-2"},ce={class:"flex flex-col gap-2"},fe={class:"mt-4 flex justify-between"},ve={key:0,class:"text-green-500 mt-4"},Ce=h({__name:"[id]",setup(ye){const{$useApi:m}=ee(),g=te();console.log(g);const A=le();ne({title:"Заказ"});const $=A.params.id,s=u({order_type:"",order_date:"",client:0,client_address:0,supplier:0,vehicle_type:"",unit:"m3",total_handled_volume:0,material_volume:0}),U=u([]),p=u([]),S=u([]),v=u([]),C=u(!0),y=u(null),b=u(""),B=async()=>{try{const{data:a}=await m.get(`/orders/${$}`);s.value={order_type:a.order_type||"",order_date:a.order_date||"",client:a.client||0,client_address:a.client_address||0,supplier:a.supplier||0,vehicle_type:a.vehicle_type||"",unit:a.unit||"m3",total_handled_volume:a.total_handled_volume||0,material_volume:a.material_volume||0};const{data:e}=await m.get("/order-types/");U.value=e;const{data:_}=await m.get("/contractors/");p.value=_;const{data:i}=await m.get("/vehicle-types/");if(S.value=i,s.value.client){const{data:x}=await m.get(`/contractor-addresses/?contractor=${s.value.client}`);v.value=x}}catch(a){y.value=a.message}finally{C.value=!1}},N=async()=>{try{const{data:a}=await m.patch(`/orders/${$}/`,s.value);s.value=a,b.value="Заказ успешно обновлён!",setTimeout(()=>b.value="",3e3)}catch(a){y.value=a.message}},O=async()=>{try{await m.delete(`/orders/${$}/`),console.log("Заказ удалён!"),g.push("/orders")}catch(a){console.error("Ошибка удаления заказа:",a)}},D=async a=>{try{const{data:e}=await m.get(`/contractor-addresses/?contractor=${a}`);v.value=e}catch(e){console.error("Ошибка загрузки адресов контрагента:",e)}};return oe(B),(a,e)=>{var I,R,M;const _=L,i=q,x=J,V=G,w=K,E=P,F=Q,k=W,j=X,z=Y,H=Z;return c(),f("div",null,[d("div",de,[d("div",re,[o(_,{onClick:e[0]||(e[0]=t=>l(g).back()),class:"h-8 w-8"},{default:n(()=>e[10]||(e[10]=[r(" < ")])),_:1}),e[11]||(e[11]=d("h1",{class:"text-2xl font-bold mb-4"},"Заказ",-1))]),l(C)?(c(),f("div",ie,e[12]||(e[12]=[d("p",null,"Загрузка...",-1)]))):l(y)?(c(),f("div",me,[d("p",null,"Ошибка загрузки: "+T(l(y)),1)])):(c(),f("div",ue,[d("div",null,[o(i,{for:"order_type"},{default:n(()=>e[13]||(e[13]=[r("Тип заказа")])),_:1}),o(x,{class:"mt-2",items:l(U).map(t=>t.name),label:l(s).order_type,onSelectedItem:e[1]||(e[1]=t=>l(s).order_type=t)},null,8,["items","label"])]),d("div",null,[o(i,{for:"order_date"},{default:n(()=>e[14]||(e[14]=[r("Дата заказа")])),_:1}),o(V,{class:"mt-2",id:"order_date",type:"date",modelValue:l(s).order_date,"onUpdate:modelValue":e[2]||(e[2]=t=>l(s).order_date=t),placeholder:"Выберите дату"},null,8,["modelValue"])]),d("div",pe,[o(i,{for:"client"},{default:n(()=>e[15]||(e[15]=[r("Клиент")])),_:1}),o(w,{items:l(p).map(t=>({value:t.id,label:t.name})),label:((I=l(p).find(t=>t.id===l(s).client))==null?void 0:I.name)||"Выбрать клиента",onSelectedItem:e[3]||(e[3]=async t=>{l(s).client=t,await D(t)})},null,8,["items","label"])]),d("div",_e,[o(i,{for:"client_address"},{default:n(()=>e[16]||(e[16]=[r("Адрес клиента")])),_:1}),o(w,{items:l(v).map(t=>({value:t.id,label:t.address})),label:((R=l(v).find(t=>t.id===l(s).client_address))==null?void 0:R.address)||"Выбрать адрес",onSelectedItem:e[4]||(e[4]=t=>l(s).client_address=t)},null,8,["items","label"])]),d("div",ce,[o(i,{for:"supplier"},{default:n(()=>e[17]||(e[17]=[r("Поставщик")])),_:1}),o(w,{items:l(p).map(t=>({value:t.id,label:t.name})),label:((M=l(p).find(t=>t.id===l(s).supplier))==null?void 0:M.name)||"Выбрать поставщика",onSelectedItem:e[5]||(e[5]=t=>l(s).supplier=t)},null,8,["items","label"])]),d("div",null,[o(i,{for:"vehicle_type"},{default:n(()=>e[18]||(e[18]=[r("Тип транспорта")])),_:1}),o(x,{class:"mt-2",items:l(S).map(t=>t.name),label:l(s).vehicle_type,onSelectedItem:e[6]||(e[6]=t=>l(s).vehicle_type=t)},null,8,["items","label"])]),d("div",null,[o(i,{for:"unit"},{default:n(()=>e[19]||(e[19]=[r("Единица измерения")])),_:1}),o(z,{modelValue:l(s).unit,"onUpdate:modelValue":e[7]||(e[7]=t=>l(s).unit=t)},{default:n(()=>[o(F,null,{default:n(()=>[o(E,{placeholder:"Выберите единицу"})]),_:1}),o(j,null,{default:n(()=>[o(k,{value:"m3"},{default:n(()=>e[20]||(e[20]=[r("м³")])),_:1}),o(k,{value:"ton"},{default:n(()=>e[21]||(e[21]=[r("Тонны")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),d("div",null,[o(i,{for:"total_handled_volume"},{default:n(()=>e[22]||(e[22]=[r("Общий объем")])),_:1}),o(V,{class:"mt-2",id:"total_handled_volume",type:"number",modelValue:l(s).total_handled_volume,"onUpdate:modelValue":e[8]||(e[8]=t=>l(s).total_handled_volume=t),placeholder:"Введите общий объем"},null,8,["modelValue"])]),d("div",null,[o(i,{for:"material_volume"},{default:n(()=>e[23]||(e[23]=[r("Объем материала")])),_:1}),o(V,{class:"mt-2",id:"material_volume",type:"number",modelValue:l(s).material_volume,"onUpdate:modelValue":e[9]||(e[9]=t=>l(s).material_volume=t),placeholder:"Введите объем материала"},null,8,["modelValue"])]),d("div",fe,[o(_,{onClick:se(O,["stop"])},{default:n(()=>e[24]||(e[24]=[r("Удалить")])),_:1}),o(_,{onClick:N},{default:n(()=>e[25]||(e[25]=[r("Сохранить")])),_:1})]),l(b)?(c(),f("p",ve,T(l(b)),1)):ae("",!0)]))]),o(H)])}}});export{Ce as default};
